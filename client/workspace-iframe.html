<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
    <title>eSIM App - Workspace Preview</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .iframe-container {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: Arial, sans-serif;
            z-index: 10;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="iframe-container">
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>eSIM App Yükleniyor...</div>
        </div>
        <iframe id="app-iframe" sandbox="allow-same-origin allow-forms allow-popups allow-scripts allow-modals"></iframe>
    </div>

    <script>
        const iframe = document.getElementById('app-iframe');
        const loading = document.getElementById('loading');
        
        // Get initialPath from URL params (Replit workspace expects this)
        const urlParams = new URLSearchParams(window.location.search);
        const initialPath = urlParams.get('initialPath') || '/';
        
        // Use same origin for iframe to avoid CORS issues
        iframe.src = window.location.origin + initialPath;
        
        iframe.onload = function() {
            loading.style.display = 'none';
            console.log('eSIM app loaded in workspace iframe');
            
            // Send ready message to parent
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'workspace-iframe-ready',
                    origin: window.location.origin
                }, '*');
            }
        };
        
        // Handle messages from parent workspace
        window.addEventListener('message', function(event) {
            if (event.origin.includes('replit.')) {
                console.log('Workspace message:', event.data);
                // Forward message to iframe if needed
                if (iframe.contentWindow) {
                    iframe.contentWindow.postMessage(event.data, window.location.origin);
                }
            }
        });
        
        // Fallback timeout
        setTimeout(() => {
            if (loading.style.display !== 'none') {
                loading.innerHTML = '<div class="loading-spinner"></div><div>App başlatılıyor...</div>';
            }
        }, 3000);
    </script>
</body>
</html>